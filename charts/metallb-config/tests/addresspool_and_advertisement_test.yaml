suite: metallb-config

tests:
  - it: should render IPAddressPool with provided addresses
    templates:
      - templates/addresspool.yaml
    values:
      - values/valid-advert.yaml
  asserts:
    - hasDocuments:
      count: 1
    - isKind:
      of: IPAddressPool
    - equal:
      path: metadata.name
      suite: metallb-config

      tests:
        - it: should render IPAddressPool with provided addresses
          templates:
            - templates/addresspool.yaml
          values:
            - values/valid-advert.yaml
          asserts:
            - hasDocuments:
                count: 1
            - isKind:
                of: IPAddressPool
            - equal:
                path: metadata.name
                value: pool-a
            - contains:
                path: spec.addresses
                content: 10.0.0.1-10.0.0.5

        - it: should render L2Advertisement referencing the pool name
          templates:
            - templates/advertisement.yaml
          values:
            - values/valid-advert.yaml
          asserts:
            - hasDocuments:
                count: 1
            - isKind:
                of: L2Advertisement
            - contains:
                path: spec.ipAddressPools
                content: pool-a
