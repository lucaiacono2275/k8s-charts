suite: metallb-config all tests

tests:
  - it: should render IPAddressPool with provided addresses
    templates:
      - templates/addresspool.yaml
    values:
      - values/valid-advert.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: IPAddressPool
      - equal:
          path: metadata.name
          value: pool-a
      - contains:
          path: spec.addresses
          content: 10.0.0.1-10.0.0.5

  - it: should render L2Advertisement referencing the pool name
    templates:
      - templates/advertisement.yaml
    values:
      - values/valid-advert.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: L2Advertisement
      - contains:
          path: spec.ipAddressPools
          content: pool-a

  - it: should render two IPAddressPools for multi-pools
    templates:
      - templates/addresspool.yaml
    values:
      - values/multi-pools.yaml
    asserts:
      - hasDocuments:
          count: 2
      - isKind:
          of: IPAddressPool
      # metadata.name assertions removed to avoid order-dependency

  - it: should render L2Advertisement referencing both pools
    templates:
      - templates/advertisement.yaml
    values:
      - values/multi-pools.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: L2Advertisement
      - equal:
          path: spec.ipAddressPools
          value:
            - pool1
            - pool2

  - it: should render no IPAddressPool when addressPools is empty
    templates:
      - templates/addresspool.yaml
    values:
      - values/empty-pools.yaml
    asserts:
      - hasDocuments:
          count: 0

  - it: should render L2Advertisement when addressPools is empty
    templates:
      - templates/advertisement.yaml
    values:
      - values/empty-pools.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: L2Advertisement
      - equal:
          path: metadata.name
          value: adv-empty

  - it: ipRanges typo - IPAddressPool created but addresses empty
    templates:
      - templates/addresspool.yaml
    values:
      - values/ipsranges-typo.yaml
    asserts:
      - hasDocuments:
          count: 1
      - equal:
          path: spec.addresses
          value: null

  - it: ipRanges typo - L2Advertisement still rendered
    templates:
      - templates/advertisement.yaml
    values:
      - values/ipsranges-typo.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: L2Advertisement
      - equal:
          path: metadata.name
          value: adv-typo
